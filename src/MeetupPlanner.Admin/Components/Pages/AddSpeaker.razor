@page "/add-speaker"
@using MeetupPlanner.Admin.Features.Speakers
@using System.ComponentModel.DataAnnotations
@inject SpeakersHttpClient SpeakersHttpClient
<h3>AddSpeaker</h3>

<div class="w-50">

	<EditForm Model="Model" OnValidSubmit="HandleValidSubmit" FormName="AddSpeakerForm">
		<DataAnnotationsValidator />
		<ValidationSummary />
		<div class="mb-3">
			<label for="name" class="form-label">Fullname</label>
			<InputText id="name" class="form-control" @bind-Value="Model!.FullName" />
		</div>

		<div class="mb-3">
			<label for="email" class="form-label">Email</label>
			<InputText id="email" class="form-control" @bind-Value="Model!.Email" />
		</div>

		<div class="mb-3">
			<label for="company" class="form-label">Company</label>
			<InputText id="company" class="form-control" @bind-Value="Model!.Company" />
		</div>


		<div class="mb-3">
			<label for="bio" class="form-label">Bio</label>
			<InputTextArea id="bio" class="form-control" @bind-Value="Model!.Bio" />
		</div>

		<div class="mb-3">
			<label for="primaryBiography" class="form-label">Set as Primary Biography</label>
			<InputCheckbox id="primaryBiography" class="form-check-input" @bind-Value="Model!.IsPrimaryBiography" />
		</div>

		<button type="submit" class="btn btn-primary">Add Speaker</button>

	</EditForm>
</div>
@code {
	[SupplyParameterFromForm]
	private SpeakerEditFormModel? Model { get; set; }

	protected override void OnInitialized() => Model ??= new SpeakerEditFormModel();

	private async Task HandleValidSubmit()
	{
		if (Model == null)
		{
			return;
		}

		var speaker = new SpeakerRequest
		{
			FullName = Model.FullName,
			Email = Model.Email,
			Company = Model.Company,
			Bio = Model.Bio,
			IsPrimaryBiography = Model!.IsPrimaryBiography
		};

		await SpeakersHttpClient.AddSpeakerAsync(speaker);
	}

	record SpeakerEditFormModel
	{
		[Required]
		public string FullName { get; set; } = string.Empty;
		[Required]
		[EmailAddress]
		public string Email { get; set; } = string.Empty;
		public string? Company { get; set; }
		public string? Bio { get; set; }
		public bool IsPrimaryBiography { get; set; } = true;
	}
}
